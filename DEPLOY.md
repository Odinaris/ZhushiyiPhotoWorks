# 部署指南

## 快速开始

### 第一步:环境准备

1. **安装微信开发者工具**
   - 下载地址: https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 安装并登录

2. **注册小程序**
   - 访问: https://mp.weixin.qq.com
   - 注册微信小程序账号
   - 获取 AppID

### 第二步:配置项目

1. **导入项目**
   ```
   - 打开微信开发者工具
   - 选择"导入项目"
   - 选择项目目录: c:/Users/Administrator/WeChatProjects/photo-works
   - 填入您的 AppID
   ```

2. **开通云开发**
   ```
   - 点击工具栏的"云开发"按钮
   - 点击"开通"
   - 选择环境名称(如: photo-works)
   - 等待环境初始化完成(约1-2分钟)
   ```

3. **配置环境ID**
   
   打开 `app.js`,修改第6行:
   ```javascript
   cloudEnvId: 'your-env-id' // 替换为云开发控制台显示的环境ID
   ```

### 第三步:创建数据库

在云开发控制台 -> 数据库,创建以下集合:

1. **users** (用户表)
2. **photographer** (摄影师信息)
3. **banners** (轮播图)
4. **categories** (分类)
5. **albums** (作品集)
6. **contact** (联系方式)

**重要**: 所有集合的权限设置为"仅创建者可读写"

### 第四步:部署云函数

在微信开发者工具中,依次部署以下云函数:

**前台云函数:**
1. `getUserRole` - 右键 -> 上传并部署:云端安装依赖
2. `getHomeData` - 右键 -> 上传并部署:云端安装依赖
3. `getCategories` - 右键 -> 上传并部署:云端安装依赖
4. `getAlbumsByCategory` - 右键 -> 上传并部署:云端安装依赖
5. `getAlbumDetail` - 右键 -> 上传并部署:云端安装依赖
6. `updateAlbumStats` - 右键 -> 上传并部署:云端安装依赖
7. `getContactInfo` - 右键 -> 上传并部署:云端安装依赖

**后台云函数:**
8. `getAdminStats` - 右键 -> 上传并部署:云端安装依赖
9. `adminBanners` - 右键 -> 上传并部署:云端安装依赖
10. `adminCategories` - 右键 -> 上传并部署:云端安装依赖
11. `adminAlbums` - 右键 -> 上传并部署:云端安装依赖
12. `adminProfile` - 右键 -> 上传并部署:云端安装依赖
13. `adminContact` - 右键 -> 上传并部署:云端安装依赖

### 第五步:准备图标资源

准备以下尺寸为 81x81px 的图标,放入 `images` 目录:

```
images/
├── tab-home.png           # 首页图标(未选中)
├── tab-home-active.png    # 首页图标(选中)
├── tab-album.png          # 作品图标(未选中)
├── tab-album-active.png   # 作品图标(选中)
├── tab-contact.png        # 联系图标(未选中)
└── tab-contact-active.png # 联系图标(选中)
```

**提示**: 可以使用在线图标生成工具,或者临时使用纯色占位图。

### 第六步:设置管理员

1. **真机预览并登录**
   ```
   - 点击工具栏"预览"
   - 用微信扫码
   - 进入小程序(会自动创建用户记录)
   ```

2. **设置管理员权限**
   ```
   - 打开云开发控制台
   - 进入数据库 -> users 集合
   - 找到您的用户记录(通过创建时间判断)
   - 点击"编辑"
   - 修改 role 字段值为: admin
   - 保存
   ```

3. **刷新小程序**
   ```
   - 下拉刷新小程序
   - 首页右上角会出现"管理后台"按钮
   ```

### 第七步:初始化内容

进入管理后台,按顺序设置:

1. **品牌信息**
   ```
   - 管理后台 -> 品牌信息
   - 填写品牌名称、签名、介绍
   - 填写拍摄风格(用逗号分隔,如: 人像,风光,纪实)
   - 保存
   ```

2. **创建分类**
   ```
   - 管理后台 -> 分类管理
   - 添加分类(如: 婚纱摄影、人像写真、风光摄影等)
   - 设置排序和状态
   - 保存
   ```

3. **上传轮播图**
   ```
   - 管理后台 -> 轮播图管理
   - 添加轮播图
   - 选择图片(建议尺寸: 750x500px)
   - 设置排序
   - 保存
   ```

4. **添加作品集**
   ```
   - 管理后台 -> 作品集管理
   - 添加作品集
   - 填写标题、描述
   - 选择分类
   - 上传封面和作品图片
   - 勾选"是否精选"(首页会展示)
   - 保存
   ```

5. **设置联系方式**
   ```
   - 管理后台 -> 联系方式管理
   - 添加常见问答
   - 添加联系方式(微信、电话等)
   - 填写工作时间和地址
   - 保存
   ```

## 测试清单

完成部署后,请测试以下功能:

### 前台功能
- [ ] 首页轮播图正常显示和切换
- [ ] 品牌信息正确展示
- [ ] 精选作品列表显示
- [ ] 作品页分类切换正常
- [ ] 作品集详情可以查看
- [ ] 图片预览和横滑功能正常
- [ ] 分享功能可用
- [ ] 联系我页面信息正确

### 后台功能
- [ ] 管理员可以看到管理入口
- [ ] 普通用户看不到管理入口
- [ ] 轮播图增删改查正常
- [ ] 分类增删改查正常
- [ ] 作品集增删改查正常
- [ ] 品牌信息保存正常
- [ ] 联系方式保存正常

## 常见问题

### 1. 云函数调用失败
**原因**: 云函数未部署或部署失败
**解决**: 
```
- 检查云函数是否全部部署成功
- 在云开发控制台查看云函数日志
- 重新部署失败的云函数
```

### 2. 数据库读取失败
**原因**: 数据库权限设置不正确
**解决**:
```
- 打开云开发控制台 -> 数据库
- 检查所有集合的权限设置
- 设置为"仅创建者可读写"
```

### 3. 图片上传失败
**原因**: 云存储空间不足或网络问题
**解决**:
```
- 检查云存储剩余空间
- 压缩图片后重试
- 检查网络连接
```

### 4. 看不到管理后台入口
**原因**: 用户角色不是admin
**解决**:
```
- 在云开发控制台 -> 数据库 -> users
- 找到您的用户记录
- 修改 role 为 admin
- 重新进入小程序
```

### 5. TabBar图标不显示
**原因**: 图标路径错误或文件不存在
**解决**:
```
- 检查 images 目录下是否有对应的图标文件
- 确认 app.json 中的路径正确
- 图标必须是 .png 格式
```

## 性能优化建议

1. **图片优化**
   ```
   - 轮播图: 750x500px, 压缩至 200KB 以内
   - 作品封面: 600x600px, 压缩至 150KB 以内
   - 作品图片: 1200x1200px, 压缩至 300KB 以内
   ```

2. **云存储**
   ```
   - 定期清理未使用的图片
   - 使用云存储CDN加速
   ```

3. **数据库**
   ```
   - 为常用字段创建索引
   - 定期清理过期数据
   ```

## 上线发布

### 1. 小程序审核
```
1. 点击微信开发者工具"上传"按钮
2. 填写版本号和项目备注
3. 登录小程序管理后台
4. 提交审核
5. 等待审核通过(一般1-7天)
6. 审核通过后点击"发布"
```

### 2. 注意事项
```
- 确保所有功能正常运行
- 准备好小程序介绍和截图
- 选择正确的服务类目
- 填写完整的小程序信息
```

## 后续维护

### 日常维护
- 定期更新作品集
- 更新轮播图内容
- 回复用户咨询
- 监控云函数调用量

### 数据备份
- 每月导出数据库数据
- 保存重要图片的本地副本
- 记录云开发环境ID

### 功能扩展
- 根据用户反馈添加新功能
- 优化用户体验
- 增加数据统计分析

---

**祝您使用愉快!** 🎉

如有问题,请参考 [README.md](README.md) 或查看微信开发者文档。
