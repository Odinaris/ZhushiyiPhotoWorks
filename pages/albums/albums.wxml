<view class="albums-container">
  <!-- Loading Overlay -->
  <view class="loading-overlay {{isLoading ? 'show' : ''}}" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">{{loadingText}}</text>
  </view>

  <!-- Category Tabs -->
  <view class="category-tabs">
    <scroll-view 
      class="tabs-scroll" 
      scroll-x="{{true}}" 
      show-scrollbar="{{false}}"
      scroll-into-view="tab-{{currentCategoryId || 'all'}}"
    >
      <view class="tabs-container">
        <view 
          id="tab-all"
          class="tab-item {{currentCategoryId === '' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-id=""
          data-name="全部"
        >
          <text class="tab-text">全部</text>
        </view>
        <view 
          id="tab-{{item._id}}"
          class="tab-item {{currentCategoryId === item._id ? 'active' : ''}}"
          wx:for="{{categories}}"
          wx:key="_id"
          bindtap="onCategoryChange"
          data-id="{{item._id}}"
          data-name="{{item.name}}"
        >
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
    
    <!-- View Toggle -->
    <view class="view-toggle">
      <button 
        class="view-mode-btn"
        bindtap="onViewModeChange"
      >
        <text class="view-icon">{{viewMode === 'single' ? '□' : '☰'}}</text>
      </button>
    </view>
  </view>

  <!-- Content Swiper -->
  <swiper 
    class="content-swiper"
    current="{{currentIndex}}"
    bindchange="onSwiperChange"
    duration="300"
    circular="{{false}}"
  >
    <swiper-item wx:for="{{categoriesWithAll}}" wx:key="_id" wx:if="{{item.albums}}">
      <scroll-view 
        class="albums-content" 
        scroll-y 
        show-scrollbar="false" 
        bindscrolltolower="onReachBottom"
      >
        <!-- <view class="content-header">
          <text class="content-title">{{item.name}}</text>
          <text class="content-count">{{item.totalCount || 0}} 个作品集</text>
        </view> -->

        <!-- Album List - Single/Double Column -->
        <view class="albums-list {{viewMode}}" data-view-mode="{{viewMode}}" wx:if="{{item.albums.length > 0}}">
          <view 
            class="album-card"
            wx:for="{{item.albums}}"
            wx:key="_id"
            wx:for-item="album"
            bindtap="goToAlbumDetail"
            data-id="{{album._id}}"
          >
            <view class="album-image-container">
              <image class="album-cover" src="{{album.coverImage}}" mode="aspectFill" lazy-load></image>
              <view class="album-overlay">
                <view class="album-overlay-content">
                  <view class="album-title">{{album.title}}</view>
                  <view class="album-desc">{{album.description}}</view>
                  <view class="album-footer">
                    <view class="album-category">{{album.categoryName}}</view>
                    <view class="album-count">{{album.images.length}} 张</view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>

        <view class="empty-container" wx:elif="{{!loading}}">
          <view class="empty-icon">□</view>
          <view class="empty-text">该分类暂无作品</view>
        </view>
        
        <!-- Loading Animation -->
        <view class="loading-container" wx:else>
          <view class="loading-spinner"></view>
          <text class="loading-text">加载中...</text>
        </view>

        <!-- Load More Status -->
        <view class="load-more" wx:if="{{item.hasMore && item.page > 1}}">
          <text>加载更多...</text>
        </view>
        <view class="load-more" wx:elif="{{item.albums.length > 0 && !item.hasMore && item.page > 1}}">
          <text>已加载全部</text>
        </view>
      </scroll-view>
    </swiper-item>
  </swiper>

  <!-- Error State -->
  <view class="error-container" wx:if="{{!loading && loadError}}">
    <view class="empty-icon">⚠</view>
    <text class="error-text">加载失败</text>
    <button class="btn-secondary" bindtap="onRetry">重试</button>
  </view>
</view>
