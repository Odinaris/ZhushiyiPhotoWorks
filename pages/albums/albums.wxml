<view class="albums-container">
  <!-- é¡¶éƒ¨åˆ†ç±»Tabæ  -->
  <view class="category-tabs">
    <scroll-view 
      class="tabs-scroll" 
      scroll-x="{{true}}" 
      show-scrollbar="{{false}}"
      scroll-into-view="tab-{{currentCategoryId || 'all'}}"
    >
      <view class="tabs-container">
        <view 
          id="tab-all"
          class="tab-item {{currentCategoryId === '' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-id=""
          data-name="å…¨éƒ¨"
        >
          <text class="tab-text">å…¨éƒ¨</text>
        </view>
        <view 
          id="tab-{{item._id}}"
          class="tab-item {{currentCategoryId === item._id ? 'active' : ''}}"
          wx:for="{{categories}}"
          wx:key="_id"
          bindtap="onCategoryChange"
          data-id="{{item._id}}"
          data-name="{{item.name}}"
        >
          <text class="tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
    
    <!-- è§†å›¾åˆ‡æ¢æŒ‰é’® -->
    <view class="view-toggle">
      <button 
        class="view-mode-btn"
        bindtap="onViewModeChange"
      >
        <text class="view-icon">{{viewMode === 'single' ? 'â˜·' : 'â˜°'}}</text>
      </button>
    </view>
  </view>

  <!-- ä½œå“é›†å†…å®¹åŒºåŸŸ -->
  <swiper 
    class="content-swiper"
    current="{{currentIndex}}"
    bindchange="onSwiperChange"
    duration="300"
    circular="{{false}}"
  >
    <swiper-item wx:for="{{categoriesWithAll}}" wx:key="_id" wx:if="{{item.albums}}">
      <scroll-view 
        class="albums-content" 
        scroll-y 
        show-scrollbar="false" 
        bindscrolltolower="onReachBottom"
      >
        <view class="content-header">
          <text class="content-title">{{item.name}}</text>
          <text class="content-count">å…± {{item.totalCount || 0}} ä¸ªä½œå“é›†</text>
        </view>

        <!-- ä½œå“é›†åˆ—è¡¨ - æ”¯æŒå•æ /åŒæ æ¨¡å¼ -->
        <view class="albums-list {{viewMode}}" data-view-mode="{{viewMode}}" wx:if="{{item.albums.length > 0}}">
          <view 
            class="album-card"
            wx:for="{{item.albums}}"
            wx:key="_id"
            wx:for-item="album"
            bindtap="goToAlbumDetail"
            data-id="{{album._id}}"
          >
            <image class="album-cover" src="{{album.coverImage}}" mode="aspectFill" lazy-load></image>
            <view class="album-overlay">
              <view class="album-title">{{album.title}}</view>
              <view class="album-desc">{{album.description}}</view>
              <view class="album-footer">
                <text class="album-category">{{album.categoryName}}</text>
                <text class="album-count">{{album.images.length}}å¼ </text>
              </view>
            </view>
          </view>
        </view>

        <view class="empty-container" wx:elif="{{!loading}}">
          <view class="empty-icon">ğŸ“·</view>
          <view class="empty-text">è¯¥åˆ†ç±»æš‚æ— ä½œå“</view>
        </view>
        
        <!-- åŠ è½½åŠ¨ç”» -->
        <view class="loading-container" wx:else>
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>

        <!-- åŠ è½½æ›´å¤šçŠ¶æ€ -->
        <view class="load-more" wx:if="{{item.hasMore && item.page > 1}}">
          <text>åŠ è½½æ›´å¤š...</text>
        </view>
        <view class="load-more" wx:elif="{{item.albums.length > 0 && !item.hasMore && item.page > 1}}">
          <text>å·²åŠ è½½å…¨éƒ¨</text>
        </view>
      </scroll-view>
    </swiper-item>
  </swiper>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:if="{{!loading && loadError}}">
    <text>åŠ è½½å¤±è´¥</text>
    <button bindtap="onRetry">é‡è¯•</button>
  </view>
</view>
